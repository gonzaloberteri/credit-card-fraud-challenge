- table:
    name: audit_flags
    schema: public
  object_relationships:
  - name: auditor
    using:
      foreign_key_constraint_on: auditor_id
  - name: transaction
    using:
      foreign_key_constraint_on: transaction_id
  select_permissions:
  - role: auditor
    permission:
      columns:
      - id
      - transaction_id
      - auditor_id
      - flag_type
      - notes
      - severity
      - status
      - created_at
      - updated_at
      filter: {}
  - role: user
    permission:
      columns:
      - id
      - transaction_id
      - flag_type
      - severity
      - status
      - created_at
      filter:
        transaction:
          credit_card:
            user:
              clerk_user_id:
                _eq: X-Hasura-User-Id
  insert_permissions:
  - role: auditor
    permission:
      columns:
      - transaction_id
      - flag_type
      - notes
      - severity
      check: {}
      set:
        auditor_id: x-hasura-user-id
  update_permissions:
  - role: auditor
    permission:
      columns:
      - flag_type
      - notes
      - severity
      - status
      filter:
        auditor_id:
          _eq: X-Hasura-User-Id
- table:
    name: audit_trail
    schema: public
  object_relationships:
  - name: user
    using:
      foreign_key_constraint_on: performed_by
  select_permissions:
  - role: auditor
    permission:
      columns:
      - id
      - entity_type
      - entity_id
      - action
      - performed_by
      - old_values
      - new_values
      - metadata
      - created_at
      filter: {}
- table:
    name: credit_cards
    schema: public
  object_relationships:
  - name: user
    using:
      foreign_key_constraint_on: user_id
  array_relationships:
  - name: transactions
    using:
      foreign_key_constraint_on:
        column: credit_card_id
        table:
          name: transactions
          schema: public
  select_permissions:
  - role: auditor
    permission:
      columns:
      - id
      - user_id
      - card_name
      - card_brand
      - last_four_digits
      - card_holder_name
      - expiry_month
      - expiry_year
      - is_active
      - created_at
      - updated_at
      filter: {}
  - role: user
    permission:
      columns:
      - id
      - card_name
      - card_brand
      - last_four_digits
      - card_holder_name
      - expiry_month
      - expiry_year
      - is_active
      - created_at
      - updated_at
      filter:
        user:
          clerk_user_id:
            _eq: X-Hasura-User-Id
  insert_permissions:
  - role: user
    permission:
      columns:
      - card_name
      - card_brand
      - last_four_digits
      - card_holder_name
      - expiry_month
      - expiry_year
      check:
        user:
          clerk_user_id:
            _eq: X-Hasura-User-Id
      set:
        user_id: x-hasura-user-id
  update_permissions:
  - role: user
    permission:
      columns:
      - card_name
      - card_brand
      - last_four_digits
      - card_holder_name
      - expiry_month
      - expiry_year
      - is_active
      filter:
        user:
          clerk_user_id:
            _eq: X-Hasura-User-Id
- table:
    name: transactions
    schema: public
  object_relationships:
  - name: credit_card
    using:
      foreign_key_constraint_on: credit_card_id
  array_relationships:
  - name: audit_flags
    using:
      foreign_key_constraint_on:
        column: transaction_id
        table:
          name: audit_flags
          schema: public
  select_permissions:
  - role: auditor
    permission:
      columns:
      - id
      - credit_card_id
      - transaction_id
      - amount
      - currency
      - description
      - merchant_name
      - merchant_category
      - transaction_date
      - posted_date
      - transaction_type
      - status
      - created_at
      - updated_at
      filter: {}
  - role: user
    permission:
      columns:
      - id
      - credit_card_id
      - transaction_id
      - amount
      - currency
      - description
      - merchant_name
      - merchant_category
      - transaction_date
      - posted_date
      - transaction_type
      - status
      - created_at
      - updated_at
      filter:
        credit_card:
          user:
            clerk_user_id:
              _eq: X-Hasura-User-Id
  insert_permissions:
  - role: user
    permission:
      columns:
      - credit_card_id
      - transaction_id
      - amount
      - currency
      - description
      - merchant_name
      - merchant_category
      - transaction_date
      - posted_date
      - transaction_type
      - status
      check:
        credit_card:
          user:
            clerk_user_id:
              _eq: X-Hasura-User-Id
- table:
    name: users
    schema: public
  array_relationships:
  - name: audit_flags
    using:
      foreign_key_constraint_on:
        column: auditor_id
        table:
          name: audit_flags
          schema: public
  - name: audit_trail_entries
    using:
      foreign_key_constraint_on:
        column: performed_by
        table:
          name: audit_trail
          schema: public
  - name: credit_cards
    using:
      foreign_key_constraint_on:
        column: user_id
        table:
          name: credit_cards
          schema: public
  select_permissions:
  - role: auditor
    permission:
      columns:
      - id
      - clerk_user_id
      - email
      - role
      - full_name
      - created_at
      - updated_at
      filter: {}
  - role: user
    permission:
      columns:
      - id
      - clerk_user_id
      - email
      - role
      - full_name
      - created_at
      - updated_at
      filter:
        clerk_user_id:
          _eq: X-Hasura-User-Id
  insert_permissions:
  - role: user
    permission:
      columns:
      - clerk_user_id
      - email
      - role
      - full_name
      check:
        clerk_user_id:
          _eq: X-Hasura-User-Id
  update_permissions:
  - role: user
    permission:
      columns:
      - email
      - full_name
      filter:
        clerk_user_id:
          _eq: X-Hasura-User-Id